#include <iostream>
using namespace std;

class Node {
public:
    int data;
    Node* next;
    Node* back;

    Node(int data, Node* next = nullptr, Node* back = nullptr) {
        this->data = data;
        this->next = next;
        this->back = back;
    }
};

// Insert before Head
Node* InsertBeforeH(Node* head, int val) {
    Node* newNode = new Node(val, head, nullptr);
    if (head != NULL)
        head->back = newNode;
    return newNode;
}

// Insert before Tail
Node* InsertBeforeTail(Node* head, int val) {
    if (head == NULL || head->next == NULL)
        return InsertBeforeH(head, val);

    Node* tail = head;
    while (tail->next != NULL)
        tail = tail->next;

    Node* prev = tail->back;
    Node* newNode = new Node(val, tail, prev);

    prev->next = newNode;
    tail->back = newNode;

    return head;
}

// Insert before K-th position
Node* InsertBeforeK(Node* head, int k, int val) {
    if (k == 1)
        return InsertBeforeH(head, val);

    Node* temp = head;
    int cnt = 1;

    while (temp != NULL && cnt < k) {
        temp = temp->next;
        cnt++;
    }

    if (temp == NULL)
        return head;

    Node* prev = temp->back;
    Node* newNode = new Node(val, temp, prev);

    prev->next = newNode;
    temp->back = newNode;

    return head;
}

// Print list
void printList(Node* head) {
    Node* temp = head;
    while (temp != NULL) {
        cout << temp->data << " ";
        temp = temp->next;
    }
    cout << endl;
}

// MAIN FUNCTION
int main() {
    // Create initial list: 10 <-> 20 <-> 30
    Node* head = new Node(10);
    Node* second = new Node(20);
    Node* third = new Node(30);

    head->next = second;
    second->back = head;
    second->next = third;
    third->back = second;

    cout << "Initial List: ";
    printList(head);

    head = InsertBeforeH(head, 5);
    cout << "After InsertBeforeHead(5): ";
    printList(head);

    head = InsertBeforeTail(head, 25);
    cout << "After InsertBeforeTail(25): ";
    printList(head);

    head = InsertBeforeK(head, 3, 15);
    cout << "After InsertBeforeK(k=3, val=15): ";
    printList(head);

    return 0;
}
